<Html> <!-- This tag is compulsory for any HTML document. -->

<head>
    <!-- Yandex.RTB -->
    <script>window.yaContextCb = window.yaContextCb || []</script>
    <script src="http://yandex.ru/ads/system/context.js" async></script>
    <!-- Yandex.RTB -->

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
            (function (m, e, t, r, i, k, a) {
                m[i] = m[i] || function () { (m[i].a = m[i].a || []).push(arguments) };
                m[i].l = 1 * new Date();
                for (var j = 0; j < document.scripts.length; j++) { if (document.scripts[j].src === r) { return; } }
                k = e.createElement(t), a = e.getElementsByTagName(t)[0], k.async = 1, k.src = r, a.parentNode.insertBefore(k, a)
            })
            (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

        ym(92937071, "init", {
            clickmap: true,
            trackLinks: true,
            accurateTrackBounce: true,
            webvisor: true
        });
    </script>
    <noscript>
        <div><img src="https://mc.yandex.ru/watch/92937071" style="position:absolute; left:-9999px;" alt="" /></div>
    </noscript>
    <!-- /Yandex.Metrika counter -->

    <link rel="stylesheet" href="/normalize.css" />
    <link rel="stylesheet" href="index.css" />
</head>

<Body>
    <section id="viewer">
        <div class="docLoaderText"></div>
        <iframe class="notLoaded">
            Loading ...
        </iframe>
    </section>

    <section class="advert">
        <div id="yandex_rtb_R-A-2271927-3"></div>
        <!-- Yandex.RTB R-A-2271927-3 -->
        <script>window.yaContextCb.push(() => {
                Ya.Context.AdvManager.render({
                    renderTo: 'yandex_rtb_R-A-2271927-3',
                    blockId: 'R-A-2271927-3'
                })
            })</script>
    </section>

    <script>
        const frame = document.querySelector("#viewer > iframe");
        const preloader = document.querySelector("section#viewer > div.docLoaderText");

        let timerCount = 30;

        function updSrc() {
            frame.setAttribute("src", `https://docs.google.com/viewerng/viewer?embedded=true&url=${new URLSearchParams(window.location.search).get("file")}`);
        }

        function updCounter() {
            preloader.innerText = `Загрузка... Ещё ${timerCount}`;
            timerCount -= 1;
        }

        const timer = setInterval(() => {
            if (timerCount > 1) {
                updCounter()
            } else {
                clearInterval(timer);
                preloader.innerHTML = "Слишком медленное соединение с сетью!<br/>Обновите страницу!";
            }
        }, 1000)

        const checker = setInterval(() => {
            console.log({ frame })
            try {
                if (!frame.contentWindow.document.body.innerText.length < 1000) {
                    updSrc();
                }
            } catch (error) {
                clearInterval(checker);
                frame.setAttribute("class", "");
            }
        }, 1000)
    </script>
</Body>

</Html>