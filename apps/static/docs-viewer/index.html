<Html> <!-- This tag is compulsory for any HTML document. -->

<head>
    <link rel="stylesheet" href="/normalize.css" />
    <link rel="stylesheet" href="index.css" />

    <!-- Yandex.RTB -->
    <script>window.yaContextCb = window.yaContextCb || []</script>
    <script src="context.js" async></script>
    <script src="https://yandex.ru/ads/system/context.js" async></script>
</head>

<Body>
    <section id="viewer">
        <div class="docLoaderText"></div>
        <iframe class="notLoaded">
            Loading ...
        </iframe>
    </section>

    <section class="advert">
        <!-- Yandex.RTB R-A-2271927-2 -->
        <div id="yandex_rtb_R-A-2271927-2"></div>
        <script>window.yaContextCb.push(() => {
                Ya.Context.AdvManager.render({
                    renderTo: 'yandex_rtb_R-A-2271927-2',
                    blockId: 'R-A-2271927-2'
                })
            })</script>
    </section>
    <script>
        const frame = document.querySelector("#viewer > iframe");
        const preloader = document.querySelector("section#viewer > div.docLoaderText");

        let timerCount = 30;

        function updSrc() {
            frame.setAttribute("src", `https://docs.google.com/viewerng/viewer?embedded=true&url=${new URLSearchParams(window.location.search).get("file")}`);
        }

        function updCounter() {
            preloader.innerText = `Загрузка... Ещё ${timerCount}`;
            timerCount -= 1;
        }

        const timer = setInterval(() => {
            if (timerCount > 1) {
                updCounter()
            } else {
                clearInterval(timer);
                preloader.innerHTML = "Слишком медленное соединение с сетью!<br/>Обновите страницу!";
            }
        }, 1000)

        const checker = setInterval(() => {
            console.log({ frame })
            try {
                if (!frame.contentWindow.document.body.innerText.length < 1000) {
                    updSrc();
                }
            } catch (error) {
                clearInterval(checker);
                frame.setAttribute("class", "");
            }
        }, 1000)
    </script>
</Body>

</Html>